import React, { createContext, useReducer, useEffect, useContext } from "react"
import "./App.css"
import { BrowserRouter, Route, Switch, useHistory } from "react-router-dom"

import Home from "./pages/Home"
import Signin from "./pages/Signin"
import Signup from "./pages/Signup"
import Profile from "./pages/Profile"
import Details from "./pages/Details"
import Create from "./pages/Create"
import { reducer, initializeState } from './reducers/userReducer'

// import jwtdecode from "jwt-decode"
// const token = localStorage.getItem("jwt")
// const decoded = jwtdecode(token);
// console.log(decoded)

export const userContext = createContext()



const Routing = () => {
    const history = useHistory()
    const {state,dispatch} = useContext(userContext)
    useEffect(()=>{
      const user = JSON.parse(localStorage.getItem("user"))
      if(user){
        dispatch({type:"USER",payload:user})
        // history.push('/')
      }else{
        history.push('/signin')
      }
    },[])

    return (
        <Switch>
            <Route exact path="/" component={Home} />
            <Route exact path="/details/:id" component={Details} />
            <Route exact path="/signin" component={Signin} />
            <Route exact path="/signup" component={Signup} />
            <Route exact path="/profile" component={Profile} />
            <Route exact path="/create" component={Create} />
        </Switch>
    )
}



const App = () => {

    const [state, dispatch] = useReducer(reducer, initializeState)
    return (
        <userContext.Provider value={{ state, dispatch }}>
        <div className="app">
            
                <BrowserRouter>

                    <Routing />

                </BrowserRouter>
            



        </div>
        </userContext.Provider>
    )
}

export default App
